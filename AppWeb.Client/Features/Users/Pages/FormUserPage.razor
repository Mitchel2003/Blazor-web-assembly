@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@page "/users/edit/{Id:int}"
@page "/users/create"

@using AppWeb.Client.Features.Users.Sections
@using MudBlazor

<PageTitle>
    @if (Id.HasValue) { @(updateVM.IsLoading ? "Loading..." : updateVM.Existing is null ? $"User #{Id}" : $"Edit User #{updateVM.Existing.Id}") }
    else { @("Create User") }
</PageTitle>

<div class="page-user-form">
    <section class="page-header mb-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-2xl font-bold">
                        @if (Id.HasValue) { @(updateVM.IsLoading ? "Loading..." : updateVM.Existing is null ? $"User #{Id}" : $"Edit User #{updateVM.Existing.Id}") }
                        else { @("Create User") }
                    </h1>
                    <p class="text-gray-500">Fill in the form and save the user</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="/users">
                        Back to Users
                    </MudButton>
                </div>
            </div>
        </div>
    </section>

    @if (Id.HasValue)
    {
        @if (updateVM.IsLoading)
        {
            <div class="container mx-auto px-4 py-8 flex justify-center">
                <MudProgressCircular Indeterminate Size="Size.Medium" />
            </div>
        }
        else
        {
            <UserFormSection OnSubmit="@(async () => await updateVM.UpdateUserAsync())"
                             ExistingUser="@updateVM.Existing"
                             Success="@updateVM.SaveSuccess"
                             Loading="@updateVM.IsSaving" 
                             Input="@updateVM.Input"/>
        }
    }
    else
    {
        <UserFormSection OnSubmit="@(async () => await createVM.CreateUserAsync())"
                         Success="@createVM.SaveSuccess"
                         Loading="@createVM.IsSaving"
                         Input="@createVM.Input"/>
    }
</div>