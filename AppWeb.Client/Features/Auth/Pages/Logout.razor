@page "/auth/logout"

@using AppWeb.Client.Auth
@using Microsoft.AspNetCore.Components
@inject JwtAuthStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject HttpClient HttpClient

<MudContainer Class="d-flex flex-column align-center justify-center" Style="height: 100vh;">
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
    <MudText Class="mt-4">Cerrando sesi贸n...</MudText>
</MudContainer>

@code {
    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Intentar llamar al endpoint de logout del servidor primero
            await HttpClient.PostAsync("api/auth/logout", null);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cerrar sesi贸n en el servidor: {ex.Message}");
            // Continuamos con el cierre de sesi贸n local incluso si falla el servidor
        }
        finally
        {
            // Limpiar el token de autenticaci贸n local
            await AuthStateProvider.SetToken(null);
            NavigationManager.NavigateTo("/auth/login");
        }
    }
}