@page "/auth/logout"

@using AppWeb.Client.Auth
@using Microsoft.AspNetCore.Components
@inject JwtAuthStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject HttpClient HttpClient

<MudContainer Class="d-flex flex-column align-center justify-center" Style="height: 100vh;">
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
    <MudText Class="mt-4">Cerrando sesión...</MudText>
</MudContainer>

@code {
    protected override async Task OnInitializedAsync()
    {
        try { await HttpClient.PostAsync("api/auth/logout", null); }
        catch (Exception ex) { Console.WriteLine($"Error al cerrar sesión en el servidor: {ex.Message}"); }
        finally
        { //Limpiar el token de autenticación local
            await AuthStateProvider.SetToken(null);
            NavigationManager.NavigateTo("/auth/login");
        }
    }
}